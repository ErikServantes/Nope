<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <title>Nope</title>
  <style>
    body { margin: 0; overflow: hidden; background: #000; color: white; font-family: Arial, sans-serif; }
    #ui {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 100;
      background: rgba(0, 0, 0, 0.7);
      padding: 10px;
      border-radius: 5px;
    }
    #diagnostics {
      position: absolute;
      top: 10px;
      right: 10px;
      z-index: 100;
      background: rgba(0, 0, 0, 0.7);
      padding: 8px;
      border-radius: 5px;
      font-size: 14px;
    }
    input, label, button { font-size: 14px; }
    /* Botões maiores: 60x60px, fonte 24px */
    #ui button { width: 60px; height: 60px; font-size: 24px; }
  </style>
</head>
<body>
  <!-- Interface de Controle -->
  <div id="ui">
    <div>
      <label for="speedRange">Velocidade (1 a 10): <span id="speedValue">1</span>x</label><br>
      <input type="range" id="speedRange" min="1" max="10" step="1" value="1">
    </div>
    <div style="margin-top:8px;">
      <button id="speedDown">–</button>
      <button id="speedUp">+</button>
    </div>
    <div style="margin-top:8px;">
      <label for="dateInput">Data:</label><br>
      <input type="date" id="dateInput">
    </div>
    <div style="margin-top:8px;">
      <span id="currentDate"></span>
    </div>
    <div style="margin-top:8px; font-size:12px;">
      (Use mouse ou toque para orbitar, dar zoom e pan)
    </div>
  </div>

  <!-- Diagnóstico: Zoom -->
  <div id="diagnostics">
    Zoom (distância): <span id="zoomValue">0</span> units
  </div>

  <!-- Three.js e OrbitControls via CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
  
  <script>
  (function(){
    // Cena, câmera, renderer e carregador de texturas
    let scene = new THREE.Scene();
    scene.background = new THREE.Color(0x000000);
    
    let camera = new THREE.PerspectiveCamera(45, window.innerWidth/window.innerHeight, 0.1, 20000);
    camera.position.set(0, 200, 500);
    
    let renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);
    
    let textureLoader = new THREE.TextureLoader();
    
    // OrbitControls
    let controls = new THREE.OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.dampingFactor = 0.05;
    controls.minDistance = 3;
    controls.maxDistance = 2000;
    
    window.addEventListener('resize', () => {
      camera.aspect = window.innerWidth/window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });
    
    // Elementos da UI
    const speedRange = document.getElementById('speedRange');
    const speedValue = document.getElementById('speedValue');
    const speedDown = document.getElementById('speedDown');
    const speedUp = document.getElementById('speedUp');
    const dateInput = document.getElementById('dateInput');
    const currentDateLabel = document.getElementById('currentDate');
    const zoomValue = document.getElementById('zoomValue');
    
    let speedSetting = parseInt(speedRange.value);
    speedValue.textContent = speedSetting;
    
    speedDown.addEventListener('click', () => {
      speedSetting = Math.max(1, speedSetting - 1);
      speedRange.value = speedSetting;
      speedValue.textContent = speedSetting;
    });
    speedUp.addEventListener('click', () => {
      speedSetting = Math.min(10, speedSetting + 1);
      speedRange.value = speedSetting;
      speedValue.textContent = speedSetting;
    });
    speedRange.addEventListener('input', function(){
      speedSetting = parseInt(this.value);
      speedValue.textContent = speedSetting;
    });
    
    const refDate = new Date();
    dateInput.value = formatDate(refDate);
    let simulationTime = 0; // em dias
    
    dateInput.addEventListener('change', function(){
      let newDate = new Date(this.value);
      simulationTime = (newDate - refDate) / 86400000;
    });
    
    function formatDate(date) {
      let yyyy = date.getFullYear();
      let mm = String(date.getMonth()+1).padStart(2, '0');
      let dd = String(date.getDate()).padStart(2, '0');
      return `${yyyy}-${mm}-${dd}`;
    }
    
    function deg2rad(deg) { return deg * Math.PI/180; }
    
    function solveKepler(M, e, tolerance=1e-6) {
      let E = M, delta = 1;
      while(Math.abs(delta) > tolerance) {
        delta = (E - e*Math.sin(E) - M)/(1 - e*Math.cos(E));
        E = E - delta;
      }
      return E;
    }
    
    function getPlanetPosition(planet, time) {
      let a = planet.a, e = planet.e, i = deg2rad(planet.i),
          Ω = deg2rad(planet.Ω), ω = deg2rad(planet.ω), M0 = deg2rad(planet.M0),
          period = planet.period;
      let n = 2*Math.PI/period;
      let M = (M0 + n*time) % (2*Math.PI);
      let E = solveKepler(M, e);
      let f = 2*Math.atan2(Math.sqrt(1+e)*Math.sin(E/2), Math.sqrt(1-e)*Math.cos(E/2));
      let r = a*(1 - e*Math.cos(E));
      let X = r*(Math.cos(Ω)*Math.cos(ω+f)-Math.sin(Ω)*Math.sin(ω+f)*Math.cos(i));
      let Y = r*(Math.sin(Ω)*Math.cos(ω+f)+Math.cos(Ω)*Math.sin(ω+f)*Math.cos(i));
      let Z = r*(Math.sin(ω+f)*Math.sin(i));
      let scale = 50;
      return new THREE.Vector3(X*scale, Z*scale, Y*scale);
    }
    
    function getOrbitPoints(planet, numPoints=100) {
      let points = [];
      let a = planet.a, e = planet.e, i = deg2rad(planet.i),
          Ω = deg2rad(planet.Ω), ω = deg2rad(planet.ω);
      for(let j=0; j<=numPoints; j++){
        let f = 2*Math.PI*j/numPoints;
        let r = a*(1-e*e)/(1+e*Math.cos(f));
        let X = r*(Math.cos(Ω)*Math.cos(ω+f)-Math.sin(Ω)*Math.sin(ω+f)*Math.cos(i));
        let Y = r*(Math.sin(Ω)*Math.cos(ω+f)+Math.cos(Ω)*Math.sin(ω+f)*Math.cos(i));
        let Z = r*(Math.sin(ω+f)*Math.sin(i));
        let scale = 50;
        points.push(new THREE.Vector3(X*scale, Z*scale, Y*scale));
      }
      return points;
    }
    
    // Dados dos planetas (orbitais, período de rotação e axialTilt para Terra e Nope)
    const planetsData = [
      { name:"Mercúrio", a:0.387, e:0.2056, i:7.005, Ω:48.331, ω:29.124, M0:174.796, period:87.97, rotationPeriod:1407.6 },
      { name:"Vênus",   a:0.723, e:0.0068, i:3.394, Ω:76.680, ω:54.884, M0:50.115, period:224.70, rotationPeriod:-5832 },
      { name:"Terra",   a:1.000, e:0.0167, i:0.000, Ω:0.000, ω:102.937, M0:357.517, period:365.256, rotationPeriod:24, axialTilt:45 },
      { name:"Marte",   a:1.524, e:0.0934, i:1.850, Ω:49.558, ω:286.502, M0:19.373, period:686.980, rotationPeriod:24.6 },
      { name:"Nope",    a:1.59,  e:0.3,   i:90.0,  Ω:0.0,   ω:0.0,   M0:0.0,     period:730, rotationPeriod:26, axialTilt:45 },
      { name:"Júpiter", a:5.203, e:0.0489, i:1.304, Ω:100.464, ω:273.867, M0:20.020, period:4332.59, rotationPeriod:9.9 },
      { name:"Saturno", a:9.537, e:0.0565, i:2.485, Ω:113.665, ω:339.392, M0:317.020, period:10759.22, rotationPeriod:10.7 },
      { name:"Urano",   a:19.191,e:0.0463, i:0.773, Ω:74.006,  ω:96.998, M0:142.238, period:30685.4, rotationPeriod:17.2 },
      { name:"Netuno",  a:30.07,  e:0.0086, i:1.770, Ω:131.784, ω:272.846, M0:256.228, period:60190, rotationPeriod:16.
